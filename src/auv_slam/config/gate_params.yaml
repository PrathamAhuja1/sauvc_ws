# Used by: gate_detector_node.py and professional_gate_navigator.py

gate_detector_node:
  ros__parameters:
    # Detection thresholds
    min_contour_area: 150  # <-- WAS 500. This is the MAIN FIX for distant detection.
    aspect_ratio_min: 1.5      # Relaxed from 2.0
    aspect_ratio_max: 15.0     # Relaxed from 12.0
    publish_debug: true
    detection_confidence_threshold: 0.5 # Relaxed from 0.7
    
    # HSV color ranges (optimized for underwater Gazebo simulation)
    # These are now nested, the detector node is updated to read them.
    red_hsv:
      lower1: [0, 70, 70]
      upper1: [15, 255, 255]
      lower2: [155, 70, 70]
      upper2: [180, 255, 255]
    
    # Green stripes (starboard side)
    green_hsv:
      lower: [45, 70, 70]
      upper: [85, 255, 255]
    
    # Orange flare (danger)
    orange_hsv:
      lower: [10, 100, 100]
      upper: [25, 255, 255]

gate_navigator_node:
  ros__parameters:
    # Target depth (gate is at -1.5m in simulation)
    target_depth: -1.5
    depth_tolerance: 0.15
    depth_correction_gain: 1.5
    
    # Speed parameters (progressive approach strategy)
    search_speed: 0.25
    acquisition_speed: 0.20
    approach_speed: 0.35
    fine_approach_speed: 0.20
    passing_speed: 0.50
    
    # Distance thresholds (meters)
    acquisition_distance: 10.0
    coarse_alignment_distance: 6.0
    approach_distance: 4.0
    fine_alignment_distance: 2.5
    final_approach_distance: 1.5
    passing_distance: 0.8
    
    # Alignment thresholds (radians)
    coarse_alignment_threshold: 0.35  # ~20 degrees
    fine_alignment_threshold: 0.12    # ~7 degrees
    passing_alignment_threshold: 0.08 # ~4.5 degrees
    
    # Adaptive yaw control gains
    yaw_gain_far: 1.2      # Far from gate (>6m)
    yaw_gain_medium: 1.8   # Medium distance (4-6m)
    yaw_gain_near: 2.5     # Near gate (2.5-4m)
    yaw_gain_fine: 3.5     # Very close (<2.5m)
    
    # Flare avoidance parameters
    flare_avoidance_gain: 1.5
    flare_critical_distance: 3.0
    emergency_avoidance_duration: 4.0
    
    # Safety and recovery
    gate_lost_timeout: 5.0
    max_search_time: 45.0
    passing_duration: 6.0
    min_detection_confidence: 0.6